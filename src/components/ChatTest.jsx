import React from "react";
import styled from "styled-components";
import catImg from "../assets/images/Illustration_cat.png";
import { useSelector } from "react-redux";

const ChatContainer = styled.div`
  width: 100%;
  height: 100%;
  min-height: 600px;
  display: flex;
  justify-content: center;
  align-items: center;
  border: 1px solid #d8d8d8;
  border-radius: 20px;
`;

const ContentsArea = styled.div`
  background: #fff;
  width: 50%;
  height: 100%;
  padding: 20px 30px;
  border-radius: 20px 0 0 20px;
`;

const LessonHeader = styled.div`
  border-radius: 8px;
`;

const LessonTitle = styled.div`
  text-align: center;
  padding: 10px;
  background: #f1f8ff;
  border-radius: 8px 8px 0 0;
  border: 1px solid #d8d8d8;
  
  h4 {
    font-size: 16px;
    font-weight: 500;
    color: #525252;
  }
`;

const LessonInfo = styled.div`
  display: flex;
  border-radius: 0 0 8px 8px;
  border: 1px solid #d8d8d8;
  border-top: none;

  > p {
    width: 50%;
    padding: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 14px;
    color: #525252;
    font-weight: 500;
    
    &:first-child {
      border-right: 1px solid #d8d8d8;
    }
  }
`;

const Content = styled.div`
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  width: 100%;
  height: 500px;
  color: #292929;

  p {
    font-size: 18px;
    font-weight: 600;
    line-height: 1.6;
    text-align: center;

    span {
      font-size: 18px;
      color: #2e90ff;
    }
  }
`;

const ChatArea = styled.div`
  width: 50%;
  height: 100%;
  padding: 20px 30px;
  background: #f1f8ff;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  border-radius: 0 20px 20px 0;
`;

const ChatStartButton = styled.button`
  width: 260px;
  height: 45px;
  margin: 0 auto;
  display: flex;
  justify-content: center;
  align-items: center;
  border-radius: 6px;
  background: #2e90ff;
  color: #fff;
  font-size: 16px;
`;

const Chat = styled.div`
  height: 580px;
`;

const ChatInputWrapper = styled.div`
  display: flex;
  gap: 10px;
`;

const ChatInput = styled.input`
  width: 90%;
  padding: 10px 15px;
  border: 1px solid #d8d8d8;
  border-radius: 6px;
  color: #525252;
  font-size: 14px;

  &::placeholder {
    color: #adadad;
    font-size: 12px;
    font-weight: 400;
  }
`;

const SendButton = styled.button`
  border-radius: 6px;
  border: 1px solid #d8d8d8;
  background: #f5f5f5;
  padding: 0 15px;
  display: flex;
  align-items: center;
  justify-content: center;
`;

const ProgressBar = styled.div`
  width: 100%;
  height: 8px;
  background-color: #f5f5f5;
  border-radius: 4px;
  margin: 20px 0;
  position: relative;
  display: flex;
  align-items: center;
`;

const Progress = styled.div`
  position: absolute;
  height: 100%;
  background-color: #2e90ff;
  border-radius: 4px;
  transition: width 0.3s ease;
  width: ${(props) => props.width}%;
  z-index: 1;
`;

const Indicator = styled.div`
  z-index: 100;
  background: #fff;
`;

const StepIndicators = styled.div`
  position: absolute;
  width: 100%;
  display: flex;
  justify-content: space-between;
  z-index: 2;
`;

const Step = styled.div`
  display: flex;
  flex-direction: column;
  align-items: center;
  margin-top: 50px;

  .label {
    font-size: 14px;
    color: #666;
    white-space: nowrap;
  }
`;

const ChatTest = () => {
  const selectedTest = useSelector((state) => state.test.selectedTest);

  console.log("selectedTest", selectedTest);
  const steps = [
    "채우기",
    "일광욕",
    "산책",
    "캣타워",
    "그림 감상",
    "간식 먹기",
    "휴식하기",
  ];

  return (
    <section>
      <h2>사전 테스트</h2>

      {selectedTest ? (
        <ChatContainer>
          <ContentsArea>
            <LessonHeader>
              <LessonTitle>
                <h4>{selectedTest.대단원}</h4>
              </LessonTitle>
              <LessonInfo>
                <p>고양이 깨우기</p>
                <p>{selectedTest.중단원}</p>
              </LessonInfo>
            </LessonHeader>

            <Content>
              <img src={catImg} alt="고양이 일러스트" />
              <div>
                <p>고양이와 털실을 모두 굴리면 채팅 수업이 끝나요 :)</p>
                <p>
                  얼마나 굴렸는지 <span>아래에서</span> 확인할 수 있어요!
                </p>
              </div>
            </Content>

            <ProgressBar>
              <Indicator>
                <svg
                  width="28"
                  height="28"
                  viewBox="0 0 28 28"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <g id="Step Indicator_Icon">
                    clipPath id="Ellipse 112" cx="14.1251" cy="13.7778"
                    r="11.7778" fill="white"/>
                    <path
                      id="Vector"
                      d="M26.6251 25.2646H19.6251C22.3707 23.8003 24.4861 21.3824 25.5726 18.4666C26.6591 15.5507 26.6418 12.3382 25.5239 9.43418C24.406 6.53019 22.2647 4.13528 19.5034 2.70063C16.7422 1.26598 13.5516 0.890647 10.5328 1.64535C7.51394 2.40005 4.87534 4.23268 3.11406 6.79797C1.35278 9.36325 0.590421 12.4841 0.970621 15.5725C1.35082 18.6609 2.84733 21.5036 5.17819 23.5652C7.50906 25.6267 10.5134 26.7646 13.6251 26.7646H26.6251C26.824 26.7646 27.0147 26.6856 27.1554 26.545C27.296 26.4043 27.3751 26.2136 27.3751 26.0146C27.3751 25.8157 27.296 25.625 27.1554 25.4843C27.0147 25.3437 26.824 25.2646 26.6251 25.2646ZM13.6251 2.76467C15.7609 2.76064 17.8532 3.36788 19.6551 4.51466C18.2566 5.11825 16.9108 5.83697 15.6313 6.66341C13.6506 5.38787 11.5144 4.37166 9.27508 3.63966C10.6523 3.06098 12.1313 2.76348 13.6251 2.76467ZM7.40008 4.64841C9.82532 5.29398 12.1447 6.2863 14.2863 7.59466C13.2825 8.32871 12.3288 9.12881 11.4313 9.98966C9.23872 8.8016 6.86384 7.98632 4.40384 7.57716C5.2124 6.42362 6.22842 5.43049 7.40008 4.64841ZM3.57259 8.96716C5.93037 9.29215 8.2158 10.0154 10.3313 11.1059C9.5126 11.9838 8.75143 12.9136 8.05258 13.8897C6.29841 13.0787 4.42233 12.563 2.50009 12.3634C2.67394 11.1813 3.03603 10.0347 3.57259 8.96716ZM4.51384 20.6059C3.1213 18.6905 2.37245 16.3827 2.37509 14.0147V13.8584C4.04091 14.0346 5.66892 14.4703 7.20009 15.1497C6.10614 16.8637 5.20524 18.6936 4.51384 20.6059ZM5.63884 21.9359C6.84521 18.2422 8.85181 14.8603 11.5155 12.0313C14.1792 9.2023 17.4344 6.99596 21.0488 5.56966C21.9832 6.39257 22.7755 7.36394 23.3938 8.44466C19.8352 9.63525 16.6266 11.6883 14.0544 14.4206C11.4822 17.1529 9.62639 20.4794 8.65258 24.1034C7.53715 23.5515 6.52055 22.8191 5.64384 21.9359H5.63884ZM13.5138 25.2634C12.3342 25.2533 11.1636 25.0572 10.0451 24.6821C10.9397 21.2256 12.6916 18.0504 15.1387 15.4504C17.5858 12.8504 20.649 10.9095 24.0451 9.80716C24.489 10.9001 24.7565 12.0566 24.8376 13.2334C22.12 14.1764 19.6711 15.7633 17.7001 17.8584C15.729 19.9535 14.2944 22.4946 13.5188 25.2646L13.5138 25.2634ZM24.8413 14.8222C24.6521 17.4016 23.5814 19.8375 21.8088 21.721C20.0362 23.6044 17.6696 24.8208 15.1063 25.1659C15.8456 22.8193 17.1056 20.6702 18.7922 18.8791C20.4788 17.0879 22.5484 15.7011 24.8463 14.8222H24.8413Z"
                      fill="#2E90FF"
                    />
                  </g>
                  <defs>
                    <clipPath id="clip0_605_6877">
                      <rect
                        width="26.5"
                        height="26.5"
                        fill="white"
                        transform="translate(0.875061 0.52832)"
                      />
                    </clipPath>
                  </defs>
                </svg>
              </Indicator>
              <Progress width={60} />

              <StepIndicators>
                {steps.map((step, index) => (
                  <Step key={index}>
                    <span className="label">{step}</span>
                  </Step>
                ))}
              </StepIndicators>
            </ProgressBar>
          </ContentsArea>

          {/* 채팅화면 */}
          <ChatArea>
            <ChatStartButton>채팅 시작</ChatStartButton>
            <Chat></Chat>
            <ChatInputWrapper>
              <ChatInput
                type="text"
                placeholder="꾹꾹이를 하려면 여기에 무엇이든 적어보세요!"
              />
              <SendButton>
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="28"
                  height="27"
                  viewBox="0 0 28 27"
                  fill="none"
                >
                  <path
                    d="M20.3667 19.6695L18.5252 15.3181C17.4019 13.162 16.0116 11.757 13.6086 11.757C11.2055 11.757 9.76915 13.162 8.63666 15.3181L6.79521 19.6695C6.65908 19.9747 6.58684 20.3075 6.58345 20.6451C6.57851 21.2939 6.81575 21.9184 7.24346 22.3826C7.67117 22.8467 8.25468 23.113 8.86684 23.1233C9.26032 23.1178 9.64636 23.0089 9.99028 22.8062C10.3342 22.6036 10.6252 22.3136 10.8372 21.9623C11.0972 21.4401 11.5001 21.0135 11.993 20.7383C12.486 20.4632 13.0459 20.3525 13.5994 20.4207C14.1528 20.3525 14.7127 20.4632 15.2057 20.7383C15.6986 21.0135 16.1015 21.4401 16.3615 21.9623C16.5665 22.3029 16.8459 22.5862 17.176 22.7882C17.5062 22.9903 17.8773 23.1052 18.2582 23.1233C18.8711 23.1233 19.4589 22.8653 19.8923 22.406C20.3257 21.9468 20.5692 21.3239 20.5692 20.6744C20.5743 20.3275 20.5051 19.9839 20.3667 19.6695ZM8.17906 7.0486C8.21674 7.41271 8.31068 7.76685 8.45545 8.09055C8.60023 8.41425 8.79296 8.70108 9.02251 8.93444C9.25205 9.16781 9.51385 9.34308 9.79276 9.45012C10.0717 9.55717 10.3622 9.59385 10.6474 9.55806C10.9327 9.52227 11.207 9.41471 11.4546 9.2416C11.7022 9.06849 11.9182 8.83327 12.09 8.54955C12.2617 8.26583 12.3859 7.93924 12.4554 7.58866C12.5248 7.23808 12.5381 6.87048 12.4945 6.50712C12.4568 6.14302 12.3629 5.78887 12.2181 5.46517C12.0733 5.14148 11.8806 4.85465 11.651 4.62128C11.4215 4.38791 11.1597 4.21264 10.8808 4.1056C10.6019 3.99856 10.3114 3.96187 10.0261 3.99766C9.74088 4.03346 9.46651 4.14102 9.21891 4.31412C8.9713 4.48723 8.75536 4.72245 8.5836 5.00617C8.41183 5.28989 8.28763 5.61649 8.21819 5.96707C8.14876 6.31764 8.13546 6.68524 8.17906 7.0486Z"
                    fill="white"
                    stroke="#9A9A9A"
                    strokeWidth="0.552083"
                    strokeLinecap="round"
                    strokeLinejoin="round"
                  />
                  <path
                    d="M3.03081 12.2079C3.12684 12.5552 3.277 12.8827 3.47262 13.1717C3.66825 13.4608 3.90547 13.7055 4.17061 13.8919C4.43575 14.0782 4.72356 14.2025 5.01744 14.2576C5.31133 14.3126 5.60547 14.2973 5.88292 14.2126C6.16036 14.1279 6.41561 13.9754 6.63396 13.7639C6.8523 13.5525 7.02942 13.2862 7.15509 12.9805C7.28077 12.6748 7.35251 12.3357 7.36619 11.9828C7.37987 11.6299 7.33521 11.2701 7.23479 10.9242C7.13701 10.5794 6.98581 10.2546 6.78984 9.96831C6.59386 9.68202 6.35694 9.43987 6.09261 9.2557C5.82828 9.07153 5.54171 8.94893 5.24926 8.8949C4.95682 8.84088 4.66422 8.85649 4.38819 8.94084C4.11215 9.0252 3.85807 9.17664 3.64047 9.38653C3.42286 9.59642 3.24599 9.86064 3.11995 10.1641C2.9939 10.4676 2.92115 10.8043 2.90586 11.1552C2.89057 11.506 2.93302 11.8641 3.03081 12.2089M16.5582 9.43717C16.8459 9.47777 17.1398 9.44648 17.4227 9.34511C17.7056 9.24374 17.9719 9.07433 18.2061 8.8467C18.4403 8.61908 18.6377 8.33779 18.787 8.01918C18.9362 7.70058 19.0342 7.35101 19.0753 6.99081C19.1164 6.6306 19.0997 6.26694 19.0264 5.92096C18.953 5.57498 18.8243 5.25358 18.6478 4.97545C18.4713 4.69732 18.2505 4.468 17.9983 4.30081C17.746 4.13363 17.4673 4.03193 17.1784 4.00161C16.8907 3.96101 16.5968 3.9923 16.3139 4.09367C16.031 4.19504 15.7647 4.36446 15.5305 4.59208C15.2963 4.81971 15.0989 5.101 14.9497 5.4196C14.8004 5.7382 14.7024 6.08777 14.6613 6.44797C14.6202 6.80818 14.6369 7.17184 14.7102 7.51782C14.7836 7.8638 14.9123 8.1852 15.0888 8.46333C15.2653 8.74146 15.4861 8.97079 15.7383 9.13797C15.9906 9.30515 16.2693 9.40685 16.5582 9.43717Z"
                    fill="white"
                  />
                  <path
                    d="M3.03081 12.2079C3.12684 12.5552 3.277 12.8827 3.47262 13.1717C3.66825 13.4608 3.90547 13.7055 4.17061 13.8919C4.43575 14.0782 4.72356 14.2025 5.01744 14.2576C5.31133 14.3126 5.60547 14.2973 5.88292 14.2126C6.16036 14.1279 6.41561 13.9754 6.63396 13.7639C6.8523 13.5525 7.02942 13.2862 7.15509 12.9805C7.28077 12.6748 7.35251 12.3357 7.36619 11.9828C7.37987 11.6299 7.33521 11.2701 7.23479 10.9242C7.13701 10.5794 6.98581 10.2546 6.78984 9.96831C6.59386 9.68202 6.35694 9.43987 6.09261 9.2557C5.82828 9.07153 5.54171 8.94893 5.24926 8.8949C4.95682 8.84088 4.66422 8.85649 4.38819 8.94084C4.11215 9.0252 3.85807 9.17664 3.64047 9.38653C3.42286 9.59642 3.24599 9.86064 3.11995 10.1641C2.9939 10.4676 2.92115 10.8043 2.90586 11.1552C2.89057 11.506 2.93302 11.8641 3.03081 12.2089M16.5582 9.43717C16.8459 9.47777 17.1398 9.44648 17.4227 9.34511C17.7056 9.24374 17.9719 9.07433 18.2061 8.8467C18.4403 8.61908 18.6377 8.33779 18.787 8.01918C18.9362 7.70058 19.0342 7.35101 19.0753 6.99081C19.1164 6.6306 19.0997 6.26694 19.0264 5.92096C18.953 5.57498 18.8243 5.25358 18.6478 4.97545C18.4713 4.69732 18.2505 4.468 17.9983 4.30081C17.746 4.13363 17.4673 4.03193 17.1784 4.00161C16.8907 3.96101 16.5968 3.9923 16.3139 4.09367C16.031 4.19504 15.7647 4.36446 15.5305 4.59208C15.2963 4.81971 15.0989 5.101 14.9497 5.4196C14.8004 5.7382 14.7024 6.08777 14.6613 6.44797C14.6202 6.80818 14.6369 7.17184 14.7102 7.51782C14.7836 7.8638 14.9123 8.1852 15.0888 8.46333C15.2653 8.74146 15.4861 8.97079 15.7383 9.13797C15.9906 9.30515 16.2693 9.40685 16.5582 9.43717Z"
                    stroke="#9A9A9A"
                    strokeWidth="0.552083"
                    strokeLinecap="round"
                    strokeLinejoin="round"
                  />
                  <path
                    d="M21.5458 14.2141C21.8643 14.2967 22.2024 14.3133 22.5406 14.2631C22.8789 14.2129 23.2105 14.0969 23.5166 13.9216C23.8226 13.7463 24.097 13.5153 24.324 13.2419C24.5509 12.9684 24.7259 12.6579 24.8389 12.3282C24.9519 11.9985 25.0007 11.6561 24.9824 11.3208C24.9641 10.9854 24.8792 10.6637 24.7325 10.3741C24.5857 10.0845 24.3801 9.8328 24.1274 9.63343C23.8747 9.43406 23.58 9.29097 23.2601 9.21239C22.9421 9.13206 22.605 9.11721 22.2681 9.16869C21.9312 9.22017 21.601 9.33698 21.2965 9.51244C20.992 9.6879 20.7191 9.91858 20.4933 10.1913C20.2676 10.464 20.0934 10.7735 19.9808 11.102C19.8681 11.4304 19.8192 11.7715 19.8369 12.1057C19.8545 12.4399 19.9384 12.7607 20.0836 13.0498C20.2288 13.3389 20.4326 13.5906 20.6833 13.7905C20.934 13.9904 21.2267 14.1347 21.5447 14.215"
                    fill="white"
                  />
                  <path
                    d="M21.5458 14.2141C21.8643 14.2967 22.2024 14.3133 22.5406 14.2631C22.8789 14.2129 23.2105 14.0969 23.5166 13.9216C23.8226 13.7463 24.097 13.5153 24.324 13.2419C24.5509 12.9684 24.7259 12.6579 24.8389 12.3282C24.9519 11.9985 25.0007 11.6561 24.9824 11.3208C24.9641 10.9854 24.8792 10.6637 24.7325 10.3741C24.5857 10.0845 24.3801 9.8328 24.1274 9.63343C23.8747 9.43406 23.58 9.29097 23.2601 9.21239C22.9421 9.13206 22.605 9.11721 22.2681 9.16869C21.9312 9.22017 21.601 9.33698 21.2965 9.51244C20.992 9.6879 20.7191 9.91858 20.4933 10.1913C20.2676 10.464 20.0934 10.7735 19.9808 11.102C19.8681 11.4304 19.8192 11.7715 19.8369 12.1057C19.8545 12.4399 19.9384 12.7607 20.0836 13.0498C20.2288 13.3389 20.4326 13.5906 20.6833 13.7905C20.934 13.9904 21.2267 14.1347 21.5447 14.215"
                    stroke="#9A9A9A"
                    strokeWidth="0.552083"
                    strokeLinecap="round"
                    strokeLinejoin="round"
                  />
                </svg>
              </SendButton>
            </ChatInputWrapper>
          </ChatArea>
        </ChatContainer>
      ) : (
        <ChatContainer style={{ border: "1px solid #e6e6e6", borderRadius: "20px" }}>
          <Content>
            <img src={catImg} alt="고양이 일러스트" />
            <div style={{ textAlign: "center", marginTop: "50px" }}>
              <p>위 게시판에서 테스트 실행 버튼을 누르면</p>
              <p>
                <span>사전 테스트</span>(학생 배포용)가 시작됩니다.
              </p>
            </div>
          </Content>
        </ChatContainer>
      )}
    </section>
  );
};

export default ChatTest;
